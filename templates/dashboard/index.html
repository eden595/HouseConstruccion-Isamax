{% extends "partials/layouts/main.html" %} 
{% load static %} 
{#===================== META ===================== #} 
{% block meta %} 
	{% with title="Index" %} 
		{% include "partials/title-meta.html" %} 
	{% endwith %} 
{%endblock meta %} 

{# ===================== CSS ===================== #} 
{% block css %}
<!-- Librerías -->
	<link rel="stylesheet" href="{% static 'assets/libs/gridjs/theme/mermaid.min.css' %}"/>
	<link rel="stylesheet" href="{% static 'assets/css/style.css' %}" />
{% endblock css %} 

{# ===================== CONTENIDO ===================== #}
{% block content %} {# ---------- LO QUE YA TENÍAS (NO TOCADO) ---------- #}
	<div class="row g-4">
		<hr class="my-4" />
		<div class="col-12">
			<h2 class="fw-bold mb-3">Dashboard</h2>
			<p class="text-muted">Bienvenido a tu panel principal.</p>
		</div>

		<!-- ====== EJEMPLO DE CARD ====== -->
		<div class="col-md-6 col-lg-4">
			<div class="card shadow-sm border-0">
				<div class="card-body">
					<h5 class="fw-semibold">Usuarios activos</h5>
					<p class="text-muted small">Información general del sistema</p>
					<h2 class="fw-bold mb-0">128</h2>
				</div>
			</div>
		</div>
	

		<!-- ====== OTRO EJEMPLO DE CARD ====== -->
		<div class="col-md-6 col-lg-4">
			<div class="card shadow-sm border-0">
				<div class="card-body">
					<h5 class="fw-semibold">Pedidos del día</h5>
					<p class="text-muted small">Total procesados</p>
					<h2 class="fw-bold mb-0">45</h2>
				</div>
			</div>
		</div> 

		<!-- ====== OTRO EJEMPLO MÁS ====== -->
		<div class="col-md-6 col-lg-4">
			<div class="card shadow-sm border-0">
				<div class="card-body">
					<h5 class="fw-semibold">Tasa de conversión</h5>
					<p class="text-muted small">Últimos 7 días</p>
					<h2 class="fw-bold mb-0">3.8%</h2>
				</div>
			</div>
		</div>
	</div>
	<hr class="my-4" />

	{# ---------- TU DASHBOARD HOUSE CONSTRUCTION AÑADIDO ---------- #}
	<div class="row">
		<div class="col-12">
			<div class="page-title-box d-sm-flex align-items-center justify-content-between">
				<h4 class="mb-sm-0">Dashboard - House Construction</h4>
				<div class="page-title-right">
					<ol class="breadcrumb m-0">
						<li class="breadcrumb-item"><a href="{% url 'home' %}">Inicio</a></li>
						<li class="breadcrumb-item active">Dashboard</li>
					</ol>
				</div>
			</div>
		</div>
	</div>

	<!-- Tarjetas de Resumen -->
	<div class="row">
		<div class="col-xl-3 col-md-6">
			<div class="card card-animate">
				<div class="card-body">
					<div class="d-flex align-items-center">
						<div class="flex-grow-1">
							<p class="text-uppercase fw-medium text-muted mb-0">Total Gastos</p>
						</div>
						<div class="flex-shrink-0">
							<h5 class="text-success fs-14 mb-0">
								<i class="ri-arrow-right-up-line fs-13 align-middle"></i> +12.5%
							</h5>
						</div>
					</div>
					<div class="d-flex align-items-end justify-content-between mt-4">
						<div>
							<h4 class="fs-22 fw-semibold ff-secondary mb-4">
								$<span class="counter-value" data-target="2647">0</span>
							</h4>
							<span class="badge bg-warning me-1">Mensual</span>
						</div>
						<div class="avatar-sm flex-shrink-0">
							<span class="avatar-title bg-soft-info text-info rounded fs-3">
							<i class="ri-money-dollar-circle-line"></i>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-xl-3 col-md-6">
			<div class="card card-animate">
				<div class="card-body">
					<div class="d-flex align-items-center">
						<div class="flex-grow-1">
							<p class="text-uppercase fw-medium text-muted mb-0">Obras Activas</p>
						</div>
						<div class="flex-shrink-0">
							<h5 class="text-success fs-14 mb-0">
								<i class="ri-arrow-right-up-line fs-13 align-middle"></i> +8.2%
							</h5>
						</div>
					</div>
					<div class="d-flex align-items-end justify-content-between mt-4">
						<div>
							<h4 class="fs-22 fw-semibold ff-secondary mb-4">
								<span class="counter-value" data-target="12">0</span>
							</h4>
							<span class="badge bg-success me-1">Proyectos</span>
						</div>
						<div class="avatar-sm flex-shrink-0">
							<span class="avatar-title bg-soft-primary text-primary rounded fs-3">
								<i class="ri-building-line"></i>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-xl-3 col-md-6">
			<div class="card card-animate">
				<div class="card-body">
					<div class="d-flex align-items-center">
						<div class="flex-grow-1">
							<p class="text-uppercase fw-medium text-muted mb-0">Registros del Mes</p>
						</div>
						<div class="flex-shrink-0">
							<h5 class="text-danger fs-14 mb-0">
								<i class="ri-arrow-right-down-line fs-13 align-middle"></i> -3.2%
							</h5>
						</div>
					</div>
					<div class="d-flex align-items-end justify-content-between mt-4">
						<div>
							<h4 class="fs-22 fw-semibold ff-secondary mb-4">
								<span class="counter-value" data-target="847">0</span>
							</h4>
							<span class="badge bg-info me-1">Libro de Obras</span>
						</div>
						<div class="avatar-sm flex-shrink-0">
							<span class="avatar-title bg-soft-warning text-warning rounded fs-3">
								<i class="ri-file-list-3-line"></i>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-xl-3 col-md-6">
			<div class="card card-animate">
				<div class="card-body">
					<div class="d-flex align-items-center">
						<div class="flex-grow-1">
							<p class="text-uppercase fw-medium text-muted mb-0">Avance Promedio</p>
						</div>
						<div class="flex-shrink-0">
							<h5 class="text-success fs-14 mb-0">
								<i class="ri-arrow-right-up-line fs-13 align-middle"></i> +5.8%
							</h5>
						</div>
					</div>
					<div class="d-flex align-items-end justify-content-between mt-4">
						<div>
							<h4 class="fs-22 fw-semibold ff-secondary mb-4">
								<span class="counter-value" data-target="67">0</span>%
							</h4>
							<span class="badge bg-primary me-1">Obras</span>
						</div>
						<div class="avatar-sm flex-shrink-0">
							<span class="avatar-title bg-soft-success text-success rounded fs-3">
								<i class="ri-bar-chart-box-line"></i>
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Gráficos -->
	<div class="row">
		<div class="col-xl-8">
			<div class="card">
				<div class="card-header border-0 align-items-center d-flex">
					<h4 class="card-title mb-0 flex-grow-1">Gastos Mensuales</h4>
					<div>
						<button type="button" class="btn btn-soft-secondary btn-sm">Ver Todo</button>
					</div>
				</div>
				<div class="card-body p-0 pb-2">
					<div class="w-100">
						<div id="gastos-chart" class="apex-charts" dir="ltr" style="min-height: 365px">
						</div>			
					</div>
				</div>
			</div>
		</div>

		<div class="col-xl-4">
			<div class="card card-height-100">
				<div class="card-header align-items-center d-flex">
					<h4 class="card-title mb-0 flex-grow-1">Distribución de Gastos</h4>
				</div>
				<div class="card-body">
					<div id="gastos-pie-chart" class="apex-charts" dir="ltr" style="min-height: 320px" >
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Últimos Registros -->
	<div class="row">
		<div class="col-xl-12">
			<div class="card">
				<div class="card-header align-items-center d-flex">
					<h4 class="card-title mb-0 flex-grow-1">Últimos Registros del Libro de Obras</h4>
					<div class="flex-shrink-0">
						<button type="button" class="btn btn-soft-info btn-sm">
							<i class="ri-file-list-3-line align-middle"></i> Ver Todos
						</button>
					</div>
				</div>
				<div class="card-body">
					<div class="table-responsive table-card">
						<table class="table table-borderless table-centered align-middle table-nowrap mb-0">
							<thead class="text-muted table-light">
								<tr>
									<th scope="col">Fecha</th>
									<th scope="col">Obra</th>
									<th scope="col">Actividad</th>
									<th scope="col">Responsable</th>
									<th scope="col">Estado</th>
									<th scope="col">Acción</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>25 Nov 2025</td>
									<td>
										<div class="d-flex align-items-center">
											<div class="flex-shrink-0 me-2">
												<i class="ri-building-line text-primary fs-20"></i>
											</div>
											<div class="flex-grow-1">
												Casa Familia Pérez
											</div>
										</div>
									</td>
									<td>Instalación eléctrica</td>
									<td>Juan Martínez</td>
									<td>
										<span class="badge badge-soft-success">Completado</span>
									</td>
									<td>
										<button type="button" class="btn btn-sm btn-light">
											Ver
										</button>
									</td>
								</tr>
								<tr>
									<td>24 Nov 2025</td>
									<td>
										<div class="d-flex align-items-center">
											<div class="flex-shrink-0 me-2">
												<i class="ri-building-line text-primary fs-20"></i>
											</div>
											<div class="flex-grow-1">
												Edificio Los Álamos
											</div>
										</div>
									</td>
									<td>Pintura fachada</td>
									<td>Carlos Rojas</td>
									<td>
										<span class="badge badge-soft-warning">En Progreso</span>
									</td>
									<td>
										<button type="button" class="btn btn-sm btn-light">
											Ver
										</button>
									</td>
								</tr>
								<tr>
									<td>23 Nov 2025</td>
									<td>
										<div class="d-flex align-items-center">
											<div class="flex-shrink-0 me-2">
											<i class="ri-building-line text-primary fs-20"></i>
											</div>
											<div class="flex-grow-1">
												Remodelación Oficinas
											</div>
										</div>
									</td>
									<td>Instalación de pisos</td>
									<td>Pedro González</td>
									<td>
										<span class="badge badge-soft-info">Pendiente</span>
									</td>
									<td>
										<button type="button" class="btn btn-sm btn-light">
											Ver
										</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

{% endblock content %} 


{# ===================== JS ===================== #} 

{%block js %}
<script src="{% static 'assets/libs/gridjs/gridjs.umd.js' %}"></script>
<script src="{% static 'assets/libs/apexcharts/apexcharts.min.js' %}"></script>

<!-- Inicialización de dashboard (si lo usas) -->
<script src="{% static 'assets/js/dashboard/e-commerce.init.js' %}"></script>

<!-- JS del menú del usuario (avatar arriba a la derecha) -->
<!-- <script src="{% static 'assets/js/ui/user-menu.init.js' %}"></script> -->

<!-- App general -->
<script type="module" src="{% static 'assets/js/app.js' %}"></script>

{# ==== TUS GRÁFICOS DE GASTOS ==== #}
<script>
  	// Gráfico de Gastos Mensuales
	var gastosOptions = {
		series: [
			{
				name: "Gastos",
				data: [2800, 3200, 2900, 3500, 3100, 3800, 3400, 3900, 4200, 3700, 4100, 4500,],
			},
		],
		chart: {
			type: "area",
			height: 350,
			toolbar: { show: false },
		},
		colors: ["#FF5722"],
		dataLabels: { enabled: false },
		stroke: {
			curve: "smooth",
			width: 3,
		},
		xaxis: {
			categories: [
				"Ene",
				"Feb",
				"Mar",
				"Abr",
				"May",
				"Jun",
				"Jul",
				"Ago",
				"Sep",
				"Oct",
				"Nov",
				"Dic",
			],
		},
		yaxis: {
			labels: {
				formatter: function (value) {
				return "$" + value;
				},
			},
		},
		tooltip: {
			y: {
				formatter: function (value) {
				return "$" + value;
				},
			},
		},
	};

	var gastosChart = new ApexCharts(
			document.querySelector("#gastos-chart"),
			gastosOptions
		);
	gastosChart.render();

  	// Gráfico de Distribución
	var pieOptions = {
		series: [44, 25, 18, 13],
		chart: { type: "donut", height: 320 },
		labels: ["Materiales", "Mano de Obra", "Equipos", "Otros"],
		colors: ["#003366", "#FF5722", "#FFC107", "#4CAF50"],
		legend: { position: "bottom" },
		dataLabels: {
			enabled: true,
			formatter: function (val) {
				return val.toFixed(0) + "%";
			},
		},
	};

	var pieChart = new ApexCharts(
		document.querySelector("#gastos-pie-chart"),
		pieOptions
	);
	pieChart.render();
</script>
{% endblock js %}
